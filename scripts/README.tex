\documentclass[a4paper,10pt]{paper}

\usepackage[utf8]{inputenc}
\setlength{\parindent}{0pt}
%% say no to serif
\renewcommand*\familydefault{\sfdefault}
\usepackage{amsmath}
\usepackage[inner=2.5cm,outer=2.5cm,bottom=2.5cm,top=2.5cm]{geometry}

%% allow referencing of enumerated lists
\usepackage{enumitem}

%% bibliography
\usepackage{nameref}
\usepackage[british]{babel}
\usepackage[
    style=apa,
    backend=biber,
    url=true, 
    doi=false,
    eprint=false,
    bibencoding=utf8
]{biblatex}
\DeclareLanguageMapping{british}{british-apa}
\DeclareFieldFormat{apacase}{#1}  % otherwise apa sentence cases
\addbibresource{corpora.bib}

% ==========
% non-R code
% ==========

\RequirePackage{listings}
\lstset{
    basicstyle=\footnotesize,
    xleftmargin=1.4em,
    framextopmargin=10pt,
    framexbottommargin=10pt,
    frame=tb, framerule=0pt,
}

\date{}

\author{
    \scriptsize
    \parbox{0.25\textwidth}{
       \small
       Anna Čermáková \\
       \scriptsize
       Centre for Corpus Research\\ College of Arts and Law\\ University of Birmingham\\
       \texttt{a.cermakova@bham.ac.uk}
    }
    \parbox{0.30\textwidth}{
        \small Anthony Hennessey \\
        \scriptsize
        Statistics and Probability\\ School of Mathematical Sciences\\ University of Nottingham \\
        \texttt{anthony.hennessey@nottingham.ac.uk}
    }
    \\ \\
    \parbox{0.30\textwidth}{
       \small
       Jamie Lentin \\
       \scriptsize
       Shuttle Thread\\ Manchester \\
       \texttt{jamie.lentin@shuttlethread.com}
    }
    \parbox{0.25\textwidth}{
       \small
       Michaela Mahlberg \\
       \scriptsize
       Centre for Corpus Research\\ College of Arts and Law\\ University of Birmingham \\
       \texttt{m.a.mahlberg@bham.ac.uk}
    }
    \parbox{0.25\textwidth}{
       \small
       Viola Wiegand \\
       \scriptsize
       Centre for Corpus Research\\ College of Arts and Law\\ University of Birmingham \\
       \texttt{v.wiegand@bham.ac.uk}
    }
}

\title{README}

\begin{document}

\nocite{*}

\maketitle

\tableofcontents

\section{Corpora}

\subsection{ChiLit - Children's Literature}
From work by Anna Čermáková.

\subsubsection{Included texts}
\printbibliography[heading=none,keyword=ChiLit]

\subsection{Other}
A collection of 'other' texts with more set titles from A-Level and GCSE exam specifications.

\subsubsection{Included texts}
\printbibliography[heading=none,keyword=Other]

\section{Cleaning of corpora texts} \label{se:cleaning}
The sources were the Gutenberg plain text UTF-8 files.

\begin{enumerate}
    \item \label{lst:line_endings} Convert to unix line endings.
    \item \label{lst:non_auth} Remove non-authorial text.
    \item \label{lst:title} Reformat the book title and author to make consistent across all texts. 
    \item \label{lst:chapters} Reformat chapter headings to make consistent across all texts. 
    \item \label{lst:manual} Manual corrections
\end{enumerate}

Steps \ref{lst:non_auth}, \ref{lst:title} and \ref{lst:chapters} were done manually.

Step \ref{lst:line_endings} was achieved using the following command
\begin{verbatim} for f in ChiLit/*.txt; do dos2unix -m $f; done \end{verbatim}

Some specifics of step \ref{lst:non_auth}:
\begin{itemize}
    \item Tables of content are removed.
    \item Lists of illustrations are removed.
    \item Any preface text attributed to a person other than the author is removed. When attribution is unclear the text is left.
    \item Any postface text attributed to a person other than the author is removed. When attribution is unclear the text is left.
    \item Transcriber notes are removed.
    \item In the texts illustrations are usually indicated by text enclosed in square brackets.
          Where this text includes a caption the caption is kept, for example
        \begin{verbatim} [Illustration: THE WONDERSTONE.] \end{verbatim}
          becomes
        \begin{verbatim} [THE WONDERSTONE.] \end{verbatim}
          Where there is no authorial caption the construct is deleted.
          All the following example would be deleted
        \begin{verbatim} [Illustration] \end{verbatim}
        \begin{verbatim} [Illustration: Chapter Seventeen] \end{verbatim}
        \begin{verbatim} [Illustration: Page 91] \end{verbatim}
    \item The book title is put on the first line of the file, without any newlines.
    \item The book author is put on the second line of the file, without any newlines.
    \item Chapter headings are formatted as follows:
        If the chapter heading begins with `CHAPTER' or `BOOK' it must be followed by a number or roman numerals and then a dot.
        The chapter or book number cannot be written in word form.
        The heading can optionaly be followed by a chapter title; the chapter title must not break onto a new line.
        Here are some examples
        \begin{verbatim} CHAPTER 1. The Old Sea-dog at the Admiral Benbow\end{verbatim}
        \begin{verbatim} CHAPTER 2. TRAVELLING COMPANIONS.\end{verbatim}
        \begin{verbatim} CHAPTER 3.\end{verbatim}
        \begin{verbatim} CHAPTER IV. Little Meg's Treat to Her Children\end{verbatim}
        \begin{verbatim} CHAPTER V.\end{verbatim}
        \begin{verbatim} BOOK 1.\end{verbatim}
        \begin{verbatim} BOOK II. Jessica's Mother\end{verbatim}
        Sections beginning with `INTRODUCTION', `PREFACE', `CONCLUSION', `PROLOGUE', `PRELUDE' or `MORAL' are also be treated as seperate chapters.
        These do not require numbers, but do require the dot.
        Again the heading can optionaly be followed by a title; the title must not break onto a new line.
        Here are some examples
        \begin{verbatim} PREFACE.\end{verbatim}
        \begin{verbatim} INTRODUCTION.\end{verbatim}
        \begin{verbatim} PROLOGUE. THE OLYMPIANS\end{verbatim}
        \begin{verbatim} MORAL.--_There is no moral to this chapter._\end{verbatim}
        In all cases there must be no space at the beginning of the line.
    \item Part headings are on a line before the first chapter of that part, in the same format. Blank lines are allowed between the part heading and the chapter heading.
          The following example is from Treasure Island
      \begin{verbatim}PART TWO. The Sea-cook

CHAPTER 7. I Go to Bristol

IT was longer than the squire imagined ere we were ready for the sea,
and none of our first plans--not even Dr. Livesey's, of keeping me\end{verbatim}
\end{itemize}

\subsection{Converting to 7-bit ASCII.}

In addition, the Perl module \texttt{Text::Unidecode}\footnote{\url{http://search.cpan.org/perldoc?Text::Unidecode}} can be used to unify the use of hyphens, apostrophes and quotes across the texts with the following command

\begin{verbatim} perl -C -MText::Unidecode -n -i -e'print unidecode($_)' */*.txt \end{verbatim}

7-bit ASCII\footnote{\url{https://tools.ietf.org/html/rfc20}} is a subset of UTF-8\footnote{\url{https://tools.ietf.org/html/rfc3629}} and so the files may be treated as UTF-8.
Note that this will also affect accents and other special characters; for example, Hôtel becomes Hotel, archæologist becomes archaeologist and £60,000 becomes PS60,000.

\section{Maintaining this corpora repository}
\subsection{\texttt{.bib} file} \label{se:bib_file}
We currently manage the bibliography in a shared zotero folder.
The important fields in the bib entries are:
\begin{itemize}
    \item The \texttt{shorttitle} field must match the filename of the relevant text file in the corpus folder.
    \item The \texttt{keywords} field must contain the name of the corpus.
    \item The \texttt{title}, \texttt{author} and \texttt{date} fields must be present.
\end{itemize}    
Example entry:
\begin{verbatim}
    @book{grahame_wind_1908,
        title = {The Wind in the Willows},
        url = {https://www.gutenberg.org/ebooks/289},
        shorttitle = {willows},      <<===  filename willows.txt
        author = {Grahame, Kenneth},
        editor = {Lough, Mike},
        urldate = {2017-06-28},
        date = {1908},
        keywords = {{ChiLit}}        <<===  corpus id
    }
\end{verbatim}
\subsection{Adding a new text to a corpus} \label{se:add_file}
\begin{enumerate}
    \item Clean the text as described in Section~\ref{se:cleaning}.
    \item Add entry to the \texttt{.bib} file; see Section~\ref{se:bib_file}. 
    \item Generate a new \texttt{coorpora.json} file.
        \begin{verbatim}
    cd scripts
    R --no-restore --no-save <./bib2json.R \end{verbatim}
    \item Update repository tags; see Section~\ref{se:tags}.
\end{enumerate}

\subsection{Adding a new corpus}
\begin{enumerate}
    \item Edit the \texttt{scripts/bib2json.R} script to include the new corpus.
    \item For each new corpus file
        \begin{enumerate}
            \item Clean the text as described in Section~\ref{se:cleaning}.
            \item Add entry to the \texttt{.bib} file; see Section~\ref{se:bib_file}. 
        \end{enumerate}
    \item Generate a new \texttt{coorpora.json} file.
        \begin{verbatim}
    cd scripts
    R --no-restore --no-save <./bib2json.R \end{verbatim}
    \item Update repository tags; see Section~\ref{se:tags}.
\end{enumerate}
\subsection{Repository Tags} \label{se:tags}
TODO

\subsection{Updating README.pdf} \label{se:update_readme}
The README pdf is compiled with \texttt{latexmk}
\begin{verbatim}
sudo apt install latexmk texlive-latex-extra texlive-bibtex-extra biber
latexmk --outdir=./build --pdf scripts/README.tex && cp build/README.pdf .
\end{verbatim}

\end{document}
